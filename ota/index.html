<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EASY THRUSTER · App</title>
<style>
:root { --bg:#0b0f17; --card:#121826; --txt:#e8eefc; --muted:#98a2b3; --acc:#66d9ff; }
html,body{height:100%;background:var(--bg);color:var(--txt);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:980px;margin:0 auto;padding:20px}
.row{display:grid;gap:16px}
.grid-2{grid-template-columns:1fr 1fr}
.card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 4px 24px rgba(0,0,0,.25)}
h1{margin:8px 0 16px;font-size:24px}
button{background:var(--acc);color:#001018;border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
input,textarea{width:100%;background:#0e1422;color:var(--txt);border:1px solid #1f2b44;border-radius:10px;padding:10px}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#0f2236;color:#a5d9ff;border:1px solid #1f3652}
.row-kv{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center}
.log{height:180px;overflow:auto;font-family:ui-monospace,Consolas,monospace;font-size:12px;white-space:pre-wrap}
.pts{display:flex;gap:8px;flex-wrap:wrap}
.pts input{width:70px}
</style>
</head>
<body>
<div class="wrap">
<h1>EASY THRUSTER <span class="badge" id="state">未連線</span></h1>
<div class="row grid-2">
<div class="card">
<h3>連線</h3>
<button id="btnConnect">連線主控（BLE_CAN_M）</button>
<button id="btnDisconnect">斷線</button>
<div class="row-kv"><span>裝置：</span><span id="dev"></span></div>
<div class="row-kv"><span>心跳：</span><span id="hb">--</span></div>
</div>


<div class="card">
<h3>即時遙測</h3>
<div class="row-kv"><span>RPM</span><input id="rpm" readonly></div>
<div class="row-kv"><span>Throttle %</span><input id="th" readonly></div>
<div class="row-kv"><span>MAP</span><input id="map" readonly></div>
<div class="row-kv"><span>Diag</span><input id="diag" readonly></div>
</div>


<div class="card">
<h3>控制</h3>
<div class="row-kv"><span>Fan %</span><input id="fan" type="number" min="0" max="100" value="30"></div>
<div class="row" style="margin-top:8px">
<button id="btnSend">下發 FAN%</button>
<button id="btnLedOn">LED ON</button>
<button id="btnLedOff">LED OFF</button>
</div>
</div>


<div class="card">
<h3>CFG 曲線（FFF4）</h3>
<div class="pts" id="pts"></div>
<div class="row" style="margin-top:8px">
<button id="btnReadCfg">讀取</button>
<button id="btnWriteCfg">寫入</button>
</div>
</div>


<div class="card" style="grid-column:1/-1">
<h3>日誌</h3>
<div class="log" id="log"></div>
</div>
</div>
</div>
<script>
const NUS_SERVICE = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
const NUS_RX = "6e400003-b5a3-f393-e0a9-e50e24dcca9e"; // notify
const NUS_TX = "6e400002-b5a3-f393-e0a9-e50e24dcca9e"; // write
const FFF4_UUID = 0xFFF4; // readable + writable JSON


let device, gatt, nusSvc, chTx, chRx, chCfg;
let pingTimer, lastPong = 0;


function log(s){ const el=document.getElementById('log'); el.textContent += s+"\n"; el.scrollTop = el.scrollHeight; }
function setState(s){ document.getElementById('state').textContent = s; }
function enc(s){ return new TextEncoder().encode(s); }
function dec(b){ return new TextDecoder().decode(b); }
</html>
