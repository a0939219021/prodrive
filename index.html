<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>C3-LED Minimal Connect</title>
<body style="font-family:system-ui,Arial;padding:24px">
<h3>C3-LED Minimal Connect</h3>
<button id="btn" style="padding:12px 16px;font-weight:700">ğŸ”— Connect</button>
<div id="state" style="margin-top:12px">Status: (n/a)</div>
<pre id="log" style="white-space:pre-wrap;background:#111;color:#ddd;padding:10px;border-radius:8px;margin-top:12px">Ready.</pre>
<script>
const SVC  = '0000fff0-0000-1000-8000-00805f9b34fb';
const STAT = '0000fff4-0000-1000-8000-00805f9b34fb';
const log = t => document.getElementById('log').textContent = t;
const show = v => document.getElementById('state').textContent = 'Status: ' + v;

document.getElementById('btn').onclick = async ()=>{
  try{
    log('Opening chooserâ€¦');
    let dev;
    try{
      dev = await navigator.bluetooth.requestDevice({
        filters:[{ namePrefix:'C3-LED' }], optionalServices:[SVC]
      });
    }catch(_){
      dev = await navigator.bluetooth.requestDevice({
        acceptAllDevices:true, optionalServices:[SVC]
      });
    }
    const server = await dev.gatt.connect();
    const svc = await server.getPrimaryService(SVC);
    const stat = await svc.getCharacteristic(STAT);
    await stat.startNotifications();
    stat.addEventListener('characteristicvaluechanged', e=>{
      show(e.target.value.getUint8(0));
    });
    const v = (await stat.readValue()).getUint8(0);
    show(v);
    log('Ready.');
  }catch(e){
    log('Error: '+(e && e.message ? e.message : e));
    alert('Error: '+(e && e.message ? e.message : e));
  }
};

if(!('bluetooth' in navigator)){
  const t='âŒ æ­¤ç€è¦½å™¨æœªæä¾› Web Bluetoothã€‚è«‹åˆ° iOS è¨­å®šâ†’éš±ç§æ¬Šèˆ‡å®‰å…¨æ€§â†’è—ç‰™â†’é–‹å•Ÿ Bluefyï¼Œä¸¦ç”¨ Bluefy é–‹å•Ÿæ­¤æª”ã€‚';
  log(t); alert(t);
}
</script>
</body>
