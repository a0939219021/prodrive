<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BLE Debug Connect</title>
<style>body{font-family:system-ui,Segoe UI,Roboto;margin:20px;color:#e5e7eb;background:#0b1220}
h1{margin:0 0 10px} button{padding:10px 14px;border:0;border-radius:10px;background:#22d3ee;color:#001018;font-weight:700}
pre{white-space:pre-wrap;background:#111827;padding:12px;border-radius:10px;min-height:120px}</style>
<h1>BLE Debug Connect</h1>
<button id="btn">Connect</button>
<pre id="log">Log will appear here…</pre>
<script>
const log = (s)=>{document.querySelector('#log').textContent = s+"\n"+document.querySelector('#log').textContent;}
const UUID_SVC="12345678-1234-5678-1234-56789abcdef0";
const UUID_TX ="12345678-1234-5678-1234-56789abcdef1";
const UUID_RX ="12345678-1234-5678-1234-56789abcdef2";
document.querySelector('#btn').onclick = async ()=>{
  try{
    log("requestDevice…");
    const dev = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: [UUID_SVC]
    });
    log("device: "+(dev.name||"Unknown"));
    dev.addEventListener('gattserverdisconnected', ()=>log("disconnected"));
    const server = await dev.gatt.connect(); log("gatt.connect ok");
    const svc = await server.getPrimaryService(UUID_SVC); log("getPrimaryService ok");
    const chTX = await svc.getCharacteristic(UUID_TX); log("TX characteristic ok");
    const chRX = await svc.getCharacteristic(UUID_RX); log("RX characteristic ok");
    await chTX.startNotifications(); log("startNotifications ok");
    chTX.addEventListener('characteristicvaluechanged', e=>{
      let s=""; const dv=e.target.value; for(let i=0;i<dv.byteLength;i++) s+=String.fromCharCode(dv.getUint8(i));
      log("notify: "+s);
    });
    log("READY ✔ 你現在已連上 GATT");
  }catch(e){ log("ERROR: "+(e?.message||e)); }
};
</script>
