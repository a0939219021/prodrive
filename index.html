<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>THRUSTER OBD-II BLE Console</title>
<style>
  :root{
    --bg:#0b1220; --bg2:#0f172a; --card:#111827; --fg:#e5e7eb; --muted:#9ca3af; --acc:#22d3ee; --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
    --br:16px; --gap:12px;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bot: env(safe-area-inset-bottom, 0px);
  }
  *{ box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body{ height:100%; }
  body{ margin:0; background: linear-gradient(180deg, var(--bg), var(--bg2)); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial; }
  .appbar{
    position:sticky; top:0; z-index:50; padding: calc(10px + var(--safe-top)) 16px 10px;
    background: linear-gradient(180deg, rgba(11,18,32,.95), rgba(15,23,42,.7));
    backdrop-filter: blur(8px); border-bottom:1px solid rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .title{ font-size:18px; font-weight:700; letter-spacing:.3px; }
  .chip{ padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.08); background:#0b1020; color:var(--muted); }
  .chip.ok{ color:#052; background:rgba(16,185,129,.15); border-color:rgba(16,185,129,.25); }
  .chip.err{ color:#320; background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.25); }
  main{ padding:12px; max-width:980px; margin:0 auto; display:grid; gap:var(--gap); }
  .card{ background: rgba(17,24,39,.85); border: 1px solid rgba(255,255,255,.06); border-radius: var(--br); padding: 14px; backdrop-filter: blur(6px); }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .grid{ display:grid; grid-template-columns: 1fr; gap:var(--gap); }
  @media (min-width: 560px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
  @media (min-width: 920px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
  .stat{ padding:14px; border-radius:12px; background:#0b1020; border:1px solid #1f2937; display:flex; flex-direction:column; gap:6px; min-height:84px; }
  .stat label{ font-size:12px; color:var(--muted); }
  .stat b{ font-size:24px; font-weight:800; letter-spacing:.2px; color:#a5b4fc; }
  .stat small{ color:var(--muted); }
  button{ appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; color:#0b1220; background:var(--acc); }
  button.secondary{ background:#374151; color:var(--fg); }
  button.alt{ background:var(--ok); color:#062; }
  button.ghost{ background:transparent; color:var(--fg); border:1px solid rgba(255,255,255,.12); }
  button:disabled{ opacity:.5; cursor:not-allowed; }
  .field{ display:flex; align-items:center; gap:10px; background:#0b1020; border:1px solid #1f2937; border-radius:12px; padding:8px 10px; }
  .field input[type="number"]{ border:0; outline:none; background:transparent; color:var(--fg); width:110px; font-size:16px; }
  .hint{ color:var(--muted); font-size:12px; }
  .bottombar{
    position:sticky; bottom:0; z-index:40; padding:10px 12px calc(10px + var(--safe-bot));
    background: linear-gradient(0deg, rgba(11,18,32,.95), rgba(15,23,42,.7));
    border-top:1px solid rgba(255,255,255,.06);
    backdrop-filter: blur(8px);
  }
  .bottombar .wrap{ max-width:980px; margin:0 auto; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .bottombar .left{ display:flex; gap:10px; align-items:center; }
  .bottombar .right{ display:flex; gap:10px; }
  .fab{
    position:fixed; right:18px; bottom:calc(66px + var(--safe-bot)); z-index:45;
    width:56px; height:56px; border-radius:50%; display:grid; place-items:center; font-size:20px; box-shadow: 0 10px 24px rgba(34,211,238,.35);
  }
  pre{ margin:0; background:#0b1020; border:1px solid #1f2937; border-radius:12px; padding:12px; max-height:260px; overflow:auto; font-size:12px; }
  .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:calc(20px + var(--safe-bot)); background:#111827; color:var(--fg);
          border:1px solid rgba(255,255,255,.12); border-radius:999px; padding:10px 14px; font-size:14px; opacity:0; pointer-events:none; transition:.25s; z-index:60; }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
  .spacer{ flex:1; }
  .sub{ color:var(--muted); font-size:12px; }
</style>
</head>
<body>
  <div class="appbar">
    <div>
      <div class="title">THRUSTER — OBD-II / BLE</div>
      <div class="sub">6E40xxxx UUID · Bluefy / Web Bluetooth</div>
    </div>
    <div id="statusChip" class="chip">未連線</div>
  </div>

  <main>
    <section class="card">
      <div class="row">
        <button id="btnConnect">🔌 連線（名稱過濾）</button>
        <button id="btnConnectAll" class="alt">🟢 顯示所有裝置</button>
        <button id="btnDisconnect" class="secondary" disabled>❌ 中斷</button>
        <div class="spacer"></div>
        <span class="hint">若找不到，改用「顯示所有」再選 <b>THRUSTER</b></span>
      </div>
    </section>

    <section class="grid">
      <div class="stat"><label>RPM</label><b id="rpm">—</b><small id="rpmNote" class="hint"></small></div>
      <div class="stat"><label>Throttle (%)</label><b id="thr">—</b></div>
      <div class="stat"><label>MAP (kPa)</label><b id="map">—</b></div>
      <div class="stat"><label>Voltage (V)</label><b id="vbat">—</b></div>
      <div class="stat"><label>Threshold</label><b id="thres">—</b></div>
      <div class="stat"><label>Device</label><b id="devname">—</b><small class="hint" id="advHint">以名稱配對</small></div>
    </section>

    <!-- Log（預設隱藏） -->
    <section class="card" id="rawJsonSection" style="display:none;">
      <div class="row" style="justify-content:space-between;">
        <b>Raw JSON</b>
        <button id="btnClear" class="ghost">🧹 清除</button>
      </div>
      <pre id="log"></pre>
    </section>
  </main>

  <div class="bottombar">
    <div class="wrap">
      <div class="left">
        <div class="field">
          <span>Threshold</span>
          <input id="inpThreshold" type="number" min="0" max="255" step="1" value="40" />
        </div>
        <span class="hint" id="hint">寫入後會存入裝置 <code>config.json</code></span>
      </div>
      <div class="right">
        <button id="btnWrite">➡️ 寫入</button>
      </div>
    </div>
  </div>

  <button id="fabConnect" class="fab" title="Connect">🔌</button>
  <div id="toast" class="toast"></div>

<script>
// 原本 JS 程式碼保留（略）...
</script>
</body>
</html>
